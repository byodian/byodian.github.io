<!doctype html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="@byodian"><meta name="description" content="文档对象模型，简称 DOM，将 web 页面与到脚本或编程语言连接起来。"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@byodian"><meta name="twitter:creator" content="@byodian"><meta property="og:title" content="文档对象模型"><meta property="og:type" content="website"><meta property="og:url" content=""><meta property="og:description" content="文档对象模型，简称 DOM，将 web 页面与到脚本或编程语言连接起来。"><meta property="og:image" content="https://byodiandev.com/static/img/avatar-3x.png"><link rel="icon" type="image/icon" href="/static/img/favicon.ico"><link rel="stylesheet" href="/index.css"><style></style><title>文档对象模型</title></head><body><div id="root" class="container max-w-4xl mx-auto px-6 pt-4"><header class="mt-16 mb-8"><p><a class="font-bold" href="/">byodian's blog</a></p></header><div class="pb-5 mb-5 border-b border-gray-100"><h1 class="text-5xl">文档对象模型</h1><p class="text-gray-400"><time datetime="2021年4月2日">发布于2021年4月2日</time></p></div><article class="prose lg:prose-lg"><h2>DOM 和 JavaScript 的关系</h2><p>JavaScript 通过 DOM 进入和控制文档，而 DOM 利用 Javascript 提供的核心类型和语法实现更多的功能。</p><p>一个完整的 JavaScript 实现应该由核心（ECMAScript）、DOM 和 BOM 组成。</p><p>Web 浏览器作为 ECMAScript 实现的宿主环境之一，不仅提供了基本的 ECMAScript 实现，同时也提供了核心语言之外的平台特定对象和功能（如浏览器 API、 window对象）。</p><ul><li>Window 对象</li><li><code>document</code> 对象是网页内容的主要主要接入点。通过使用它，我们可以创建和改变页面中的任何内容。</li><li>BOM（Browser Object Model）浏览器宿主环境提供的另一个对象，包括对象 <code>navigator</code>、<code>location</code> ，函数 <code>alert/confirm/prompt</code></li></ul><h2>DOM 对象的数据类型</h2><ul><li>Document</li><li>Node</li><li>Element</li><li>NodeList</li><li>Attribute</li><li>NamedNodeMap</li></ul><h2>DOM 节点层次</h2><ul><li>Node 类型</li><li>Document 类型</li><li>Element 类型</li><li>Text 类型</li><li>Comment 类型</li><li>CDATSection 类型</li><li>DocumentType 类型</li><li>DocumentFragment 类型</li><li>Attr 类型</li></ul><h3>Document</h3><p>表示任何在浏览器中载入的网页，并作为网页内容的入口，也就是 DOM 树。它向网页文档本身提供了全局操作功能，能解决如何获取页面的 <code>URL</code> ，如何在文档中创建一个新元素这样的问题。</p><h3>Node</h3><p>位于文档内的每个对象都是某种节点，在 HTML 文档中，一个对象可以是元素节点、文本节点或者是元素节点。</p><h3>Element</h3><p>HTML DOM API 的 <code>HTMLElement</code> 接口增强元素对象的能力。</p><h3>NodeList</h3><p>一个 nodeList 是一格元素列表</p><h2>DOM 树</h2><p>HTML 文档是由标签嵌套而成的树形结构，因此 DOM 可以将任何 HTML 描述成一个由多层节点构成的树形结构。<strong>根据文档对象模型（DOM），每个 HTML 标签都是一个对象。</strong></p><p>节点类型有 12 种，但通常使用最多的只有以下四种节点：</p><ol><li><code>document</code> - 文档的根节点</li><li>元素节点 - HTML 标签元素</li><li>文本节点 - 包含文本</li><li>注释 - 不会显示，可以读取</li></ol><h2>遍历 DOM</h2><p>我们在使用 DOM 操作文档元素之前，需要先获取对应的 DOM 对象，把这个对象赋予一个变量，从而方便后续操作。</p><p>所有的 DOM 操作都是从 <code>document</code> 对象开始，这是 DOM 的主要入口，利用它可以进入任何节点。</p><h3>documentElement 和 body</h3><p>顶部的树节点可以通过 <code>document</code> 属性来使用</p><p><code>&lt;html&gt;</code> = <code>document.documentElement</code></p><p><code>&lt;body&gt;</code> = <code>document.body</code></p><p><code>&lt;head&gt;</code> = <code>document.head</code></p><h3>子元素</h3><ul><li><code>childNodes</code></li><li><code>firstChild</code></li><li><code>lastChild</code></li></ul><p>firstChild 和 lastfirst 属性是访问第一个和最后一个子元素的快捷方式。</p><p><code>childNodes</code> 是一个具有 <code>length</code> 属性，类似数组的可迭代对象，可使用 <code>for .. of</code> 语法或者 <code>forEach(..)</code> 方法来迭代它。</p><pre class="language-js"><code class="language-js"><span class="token comment">// for..of 语法</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> node <span class="token keyword">of</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <br>	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token comment">// forEach(..) 方法document.body.childNodes.forEach(el => console.log(el));</span></code></pre><p><strong>注意</strong>: DOM 集合是只读的，修改节点信息有其他的方法；DOM 集合是实时变化的。</p><h3>兄弟节点和父节点</h3><ul><li>兄弟节点 <code>nextSibling</code>、<code>previousSibling</code></li><li>父节点 <code>parentNode</code></li></ul><h3>在元素中遍历</h3><p>上面介绍的 <code>childNodes</code> 、<code>firstChild</code> 、<code>lastChild</code> 、<code>nextSibling</code> 、<code>previousSibling</code> 属性遍历的是所有的节点，包括文本节点、元素节点和注释节点。</p><p>而对于很多任务来说，我们只需要操作元素节点，使用下面的属性可以制作元素节点中导航。</p><ul><li><code>children</code> - 元素节点的子节点</li><li><code>firstElementChild</code>、<code>lastElementChild</code> - 第一个和最后一个元素节点</li><li><code>previousElementSibling</code>、<code>nextElementSibling</code> - 兄弟元素</li><li><code>parentElement</code> - 父元素</li></ul><p>parentNode 和 parentElement 都获取元素的父节点，但有一个例外：</p><pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span> <span class="token comment">// document</span><br>documentdocument<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>parentElement <span class="token comment">// null</span></code></pre><p><img src="https://raw.githubusercontent.com/byodian/logpic/master/parentNode%26parentElement.png?token=AGHXIYPRKJYRDHBFCLO4RO3AMXLLE" alt="the difference of parentNode and parentElement"></p><p>不同结果的原因：<code>parentNode</code> 获取的是任何类型的父节点，<code>parentElement</code> 获取的是父元素节点，而 <code>document</code> 形式上作为</p><html>的父节点，其并不是一个元素节点，因此才会出现不同的结果。<p></p><h2>getElement* 和 querySelector*</h2><ul><li><code>document.getElementById(id)</code></li><li><code>document.getElementsByTagName(tag)</code></li><li><code>document.getElementsByClassName(className)</code></li><li><code>document.getElementsByName(name)</code></li><li><code>elem.querySelector(selector)</code></li><li><code>elem.querySelectorAll(selector)</code></li></ul><h2>matches 和 closest</h2><h3>matches</h3><p><code>elem.matches(css)</code> 检查 elem 是否匹配给定的 CSS 选择器，返回 true 或者 false。</p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"example.com/txt"</span><span class="token operator">></span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>txt<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"byod.io"</span><span class="token operator">></span>byod<span class="token punctuation">.</span>io<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br><span class="token operator">&lt;</span>script<span class="token operator">></span><br>  <span class="token keyword">const</span> lists <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> list <span class="token keyword">of</span> lists<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'a[href$="txt"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><br>      <span class="token comment">// 'example.com/txt'    </span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p><code>elem.mathes(css)</code> 常用于事件委托，判断 <code>e.target</code> 是否与给定的 CSS 选择器匹配</p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn-dec"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search__btn"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>svg <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"search__icon"</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>use href<span class="token operator">=</span><span class="token string">"img/icons.svg#icon-magnifying-glass"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>use<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>svg<span class="token operator">></span><br>    <span class="token operator">&lt;</span>span<span class="token operator">></span>Search<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>  <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sumbit__btn"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>svg <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sumbit__icon"</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>use href<span class="token operator">=</span><span class="token string">"img/icons.svg#icon-magnifying"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>use<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>svg<span class="token operator">></span><br>    <span class="token operator">&lt;</span>span<span class="token operator">></span>Search<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><br><span class="token operator">&lt;</span>script<span class="token operator">></span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'.search__btn, .search__btn *'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// ...code  </span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'.sumbit__btn, .sumbit__btn *'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// ...code  </span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h3>closest</h3><p><code>elem.closest(css)</code> 会查找与 CSS 选择器匹配的最接近的祖先，包括 elem 自身。</p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"shopping"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"list"</span><span class="token operator">></span>list <span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>    <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"list"</span><span class="token operator">></span>list <span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><span class="token operator">&lt;</span>script<span class="token operator">></span>  <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>li<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.shopping'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &lt;ul>&lt;/script></span></code></pre><p><code>elem.closest(css)</code> 也常用于事件委托，判断 <code>e.target</code> 是否与给定的 CSS 选择器匹配</p><h2>Node</h2><p>不同的节点或许有不同的属性。</p><p><img src="https://github.com/byodian/blog/blob/master/doc/Node.png?raw=true" alt="Node tree"></p><p>DOM 节点是正常的 JavaScript 对象，它们使用基于原型继承属性和方法。</p><p>在浏览器控制台使用 <code>console.dir(elem)</code> 可得到 DOM 对象。</p><p><code>console.log(tree)</code> 展示元素的 DOM 树</p><h3>属性</h3><p>DOM 节点是正常的 JavaScript 对象。其中有很多内建的属性和方法，我们可以创建自己的属性和方法，也可以修改原型链上的方法。</p><ul><li>属性值可以是任何类型</li><li>属性大小写敏感</li></ul><p><strong>内建属性</strong></p><ul><li><code>nodeType</code></li><li><code>nodeName</code></li><li><code>innerHTML</code></li><li><code>outerHTML</code></li><li><code>nodeValue/data</code></li><li><code>textContent</code> 返回带格式的文本</li><li><code>innerText</code> 返回不带格式的文本</li></ul><p><strong>自建属性和方法</strong></p><pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>mydata <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'yo'</span><br>  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Imperator'</span><br><span class="token punctuation">}</span><br><br>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>mydata<span class="token punctuation">.</span>title <span class="token comment">// Imperator</span><br><br>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function-variable function">sayTagName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">sayTagName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// BODY</span></code></pre><h3>HTML attributes</h3><p>在 HTML 中，标签可能存在 attributes，当浏览器解析 HTML 为标签创建 DOM 对象时，它会辨别标准 attributes 并为他们创建 DOM 属性。</p><p>获取 attributes 值</p><ul><li><code>elem.hasAttribute(name)</code></li><li><code>elem.getAttribute(name)</code></li><li><code>elem.setAttribute(name, value)</code></li><li><code>elem.removeAttribute(name)</code></li></ul><p><strong>读取所有的 attributes</strong></p><p><code>elem.attributes</code></p><h3>小结</h3><ul><li>Attrubutes 写在 HTML 中</li><li>Properties 写在 DOM 对象中</li></ul><p>对于大部分场景，使用 DOM 属性是更合适的，只有当 DOM 属性不适合当前场景时，再参考 HTML Attributes。比如：</p><ul><li>当需要使用非标准 attribute。<code>data-</code> attribute 需要使用 <code>dataset</code></li><li>当需要读取写在 HTML 中的值，并且在 DOM 属性中是不同类型的这个值，比如，DOM 属性 <code>href</code> 返回绝对的 URL 路径，HTML attribute 只返回相对的路径。</li></ul><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>a id<span class="token operator">=</span><span class="token string">"a"</span> href<span class="token operator">=</span><span class="token string">"#hello"</span><span class="token operator">></span>link<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br><span class="token operator">&lt;</span>script<span class="token operator">></span><br>  <span class="token comment">// attribute</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// #hello</span><br><br>  <span class="token comment">// property</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>href <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// full URL in the form http://site.com/page#hello</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"div"</span> style<span class="token operator">=</span><span class="token string">"color:red;font-size:120%"</span><span class="token operator">></span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><br><span class="token operator">&lt;</span>script<span class="token operator">></span><br>  <span class="token comment">// string</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// color:red;font-size:120%</span><br><br>  <span class="token comment">// object</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object CSSStyleDeclaration]</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// red</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h2>NodeList</h2><p>Nodelist、NamedNodeMap、HTMLCollection</p><p><code>NodeList</code> 对象是节点的集合。一般通过属性和方法返回，</p><ul><li><code>Node.childNodes</code></li><li><code>document.querySelectorAll()</code></li></ul><p><code>NamedNodeMap</code> 接口代表一个 <code>Attr</code> 对象集合。</p><p><code>HTMLCollection</code> 返回元素元素节点的集合。以下属性和方法可以返回</p><ul><li><code>Node.children</code></li><li><code>document.getElementsBy*</code></li></ul><h3>Live NodeLists</h3><p>这三个集合都是“动态的”。换句话说，每当文档结构发生变化时，它们都会得到更新。它们始终都会保存着最新、最准确的信息。</p><p><strong>所有 NodeList 对象都是在访问 DOM 文档时实时运行的查询。</strong></p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>div<span class="token operator">></span>example<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  i<span class="token punctuation">,</span><br>  len<span class="token punctuation">,</span><br>  div<span class="token punctuation">;</span><br><br><span class="token comment">// NodeList [div] length = 1</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// HTMLCollection [div] length = 2</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// len = divs.length</span><br><span class="token comment">// 缓存 DOM 查询结果</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> divs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>  div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  div<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'example'</span><span class="token punctuation">;</span><br>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p><img src="https://github.com/byodian/blog/blob/master/doc/HTMLCollection&amp;NodeList.png?raw=true" alt="the difference of HTMLCollection and NodeList"></p><p>应该尽量减少访问 NodeList 的次数，因为每次访问 NodeList，都会运行一次基于文档的查询。所以，可以考虑将从 NodeList 中取得的值缓存起来。</p><h3>Static NodeLists</h3><p><code>document.querySelectorAll(selector)</code> 方法返回一个静态的 <code>NodeList</code> 。在 DOM 中任何改变都不会影响此集合的内容。</p><h2>Shadow DOM VS. Virtural DOM</h2><ol><li>Shadow DOM is a browser technology designed primarily for scoping variables and CSS in web components.</li><li>The Virtual DOM is a concept implemented by libraries in JavaScript on top of browser APIs.</li></ol><h2>HTMLTemplateElement</h2><p>属性：<code>content</code> ，只读的 <code>DocumentFragment</code></p><h2>DocumentFragment</h2><p>文档片段接口，<strong>一个没有父对象的最小文档对象。</strong></p><ul><li>不是真实DOM树的一部分，变化不会触发DOM树的重新绘制。</li><li><code>HTMLTemplateElement.content</code> 属性包含一个 <code>DocumentFragment</code></li><li>可作为<code>Node.appendChild</code> 和 <code>Node.insertBefore</code> 方法的参数，插入片段所有子节点，片段本身不插入，且此操作只会发生一次重绘操作，不会导致性能问题。</li><li>该接口在 Web 组件中非常有用。</li></ul><h2>Node.cloneNode()</h2><p>复制调用该方法节点的副本，添加到文档之前，此拷贝节点不属于当前文档树的一部分，没有父节点。</p><h2>CSSOM API</h2><p>CSS Rule tree 需要对照DOM Tree 从右向左解析CSS 的 选择器。</p><p>CSS匹配 HTML 元素是一个相当复杂和有性能问题的事情。所以，你就会在很多地方看到：<strong>DOM 树要小，CSS 尽量用 id 和 class，千万不要过渡层叠下去（避免冗余的元素嵌套）。</strong></p><h2>Reflow 成本远大于 Repaint</h2><p>下面的动作会增加成本</p><ul><li>增加，删除和修改 DOM 节点</li><li>移动 DOM 位置，制作动画等</li><li>修改 CSS 样式</li><li>Resize 窗口，滚动</li><li>修改网页默认字体</li></ul><p>display: none 会触发 reflow，visibility:hidden 只会触发 repaint，位置没有变化。</p><p>reflow 的原因：</p><ul><li>initial</li><li>Incremental， JS 操作 DOM</li><li>Resize， 尺寸变化</li><li>StyleChange</li><li>Dirty</li></ul><h2>减少 reflow/repaint</h2><ul><li><p>不要一条条地修改DOM的样式。</p><pre class="language-js"><code class="language-js"><span class="token comment">// bad</span><br><span class="token keyword">var</span> left <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span><br>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> top <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span><br><br><span class="token comment">//Good</span><br>el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'className'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">//Good</span><br><span class="token comment">// Using el.style.cssText</span></code></pre></li><li><p>DOM 离线后修改，使用<strong>documentFragment</strong> 对象在内存里操作DOM</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>fruits<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fruit</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	li<span class="token punctuation">.</span>textContent <span class="token operator">=</span> fruit<span class="token punctuation">;</span><br>	fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>list<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>不要把DOM结点的属性值放在一个循环里当成循环里的变量。</p></li><li><p>尽可能的修改层级比较低的DOM。当然，改变层级比较底的DOM有可能会造成大面积的 reflow，但是也可能影响范围很小。</p></li><li><p>使用 position 为 <code>fixed</code> 或 <code>absoulte</code> 的元素，修改它们的 CSS 代码不会 reflow。</p></li><li><p>不要使用 table 布局</p></li></ul></html></article><footer class="mb-2"><p>byodian's blog</p></footer></div><script src="/index.js"></script><script src="https://kit.fontawesome.com/d101a7035d.js" crossorigin="anonymous"></script></body></html>