<!doctype html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="@byodian"><meta name="description" content="WSL 是 Windows Subsystem for Linux 的缩写，译为适用于Linux 的 windows 子系统。"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@byodian"><meta name="twitter:creator" content="@byodian"><meta property="og:title" content="配置 wsl 开发环境"><meta property="og:type" content="website"><meta property="og:url" content=""><meta property="og:description" content="WSL 是 Windows Subsystem for Linux 的缩写，译为适用于Linux 的 windows 子系统。"><meta property="og:image" content="https://byodiandev.com/static/img/avatar-3x.png"><link rel="icon" type="image/icon" href="/static/img/favicon.ico"><link rel="stylesheet" href="/index.css"><style></style><title>配置 wsl 开发环境</title></head><body><div id="root" class="container max-w-4xl mx-auto px-6 pt-4"><header class="mt-16 mb-8"><p><a class="font-bold" href="/">byodian's blog</a></p></header><div class="pb-5 mb-5 border-b border-gray-100"><h1 class="text-5xl">配置 wsl 开发环境</h1><p class="text-gray-400"><time datetime="2022年6月5日">发布于2022年6月5日</time></p></div><article class="prose lg:prose-lg"><h2>WSL 2 介绍</h2><p><strong><a href="https://docs.microsoft.com/zh-cn/windows/wsl/about">什么是适用于 Linux 的 Windows 子系统？</a></strong></p><h2>安装 WSL 2 步骤</h2><h3>一、启用 windows 功能</h3><p>通过 PowserShell 命令或者 “设置” 开启相关的 <strong>Windows 功能</strong>。</p><p>需要开启的计算机功能有以下三个，同时还需要确保开启计算机 BIOS 虚拟化支持（一般是 BIOS 的 Intel Virtual Technology 选项），这里请自行搜索当前型号计算机 BIOS 的开启方式。</p><ul><li><p>Hyper-V （WSL 2） 这一步的目的是可以在 Windows 10 上创建虚拟机，另外还需要确保开启计算机 BIOS 虚拟化。Hyper-V 作为可选功能内置于 Windows ，支持的操作系统版本为企业版、专业版和教育版。参考 <strong><a href="https://docs.microsoft.com/zh-cn/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v">在 Windows 10 上安装 Hyper-V</a>。</strong> 如果你的操作系统为家庭版，则需要手动安装 Hyper ，参考 <strong><a href="https://zhuanlan.zhihu.com/p/356396288">Win10 家庭中文版安装 Hyper-V</a>。</strong> <strong>手动安装步骤：</strong></p><ol><li><p><strong>将如下代码添加到记事本中，并另存为 Hyper-V.cmd 文件</strong></p><pre class="language-powershell"><code class="language-powershell"><span class="token function">pushd</span> <span class="token string">"%~dp0"</span><br><span class="token function">dir</span> <span class="token operator">/</span>b <span class="token operator">%</span>SystemRoot%\servicing\Packages\<span class="token operator">*</span>Hyper-V*<span class="token punctuation">.</span>mum >hyper-v<span class="token punctuation">.</span>txt<br><span class="token keyword">for</span> <span class="token operator">/</span>f <span class="token operator">%</span><span class="token operator">%</span>i in <span class="token punctuation">(</span><span class="token string">'findstr /i . hyper-v.txt 2^>nul'</span><span class="token punctuation">)</span> <span class="token keyword">do</span> dism <span class="token operator">/</span>online <span class="token operator">/</span>norestart <span class="token operator">/</span><span class="token function">add-package</span>:<span class="token string">"%SystemRoot%\servicing\Packages\%%i"</span><br><span class="token function">del</span> hyper-v<span class="token punctuation">.</span>txt<br>Dism <span class="token operator">/</span>online <span class="token operator">/</span><span class="token function">enable-feature</span> <span class="token operator">/</span>featurename:Microsoft-Hyper-V-All <span class="token operator">/</span>LimitAccess <span class="token operator">/</span>ALL</code></pre></li><li><p>找到 Hyper-V.cmd 文件图标，在右键菜单中点击：以管理员身份运行</p></li><li><p>然后后续按命令提示执行相应的操作</p></li></ol></li><li><p>适用于 Linux 的 Windows 子系统</p></li><li><p>虚拟机平台</p></li></ul><p><strong>通过 “设置” 启用</strong></p><p>使用 Windows 徽标 + s 快捷建搜索 <strong>启用或关闭 Windows 功能</strong>，然后打开图片中选中的功能。</p><p><img src="https://i.imgur.com/61pvt0C.png" alt=""></p><p><strong>通过命令设置</strong></p><p>首先使用管理员身份打开 PowserShell，复制对应的命令。</p><ol><li><p>开启<strong>适用于 Linux 的 Windows 子系统</strong> (Enable the Windows Subsystem for Linux)</p><pre class="language-powershell"><code class="language-powershell">dism<span class="token punctuation">.</span>exe <span class="token operator">/</span>online <span class="token operator">/</span><span class="token function">enable-feature</span> <span class="token operator">/</span>featurename:Microsoft-Windows-Subsystem-Linux <span class="token operator">/</span>all <span class="token operator">/</span>norestart</code></pre></li><li><p>开启<strong>虚拟机平台</strong> (Enable Virtual Machine feature）</p><pre class="language-powershell"><code class="language-powershell">dism<span class="token punctuation">.</span>exe <span class="token operator">/</span>online <span class="token operator">/</span><span class="token function">enable-feature</span> <span class="token operator">/</span>featurename:VirtualMachinePlatform <span class="token operator">/</span>all <span class="token operator">/</span>norestart</code></pre></li><li><p>开启 <strong>Hyper-V</strong></p><pre class="language-powershell"><code class="language-powershell"><span class="token function">Enable-WindowsOptionalFeature</span> <span class="token operator">-</span>Online <span class="token operator">-</span>FeatureName Microsoft-Hyper-V <span class="token operator">-</span>All</code></pre></li></ol><h3>二、下载 Linux 内核更新包（<strong>Download the Linux kernel update package</strong>）</h3><ol><li><a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">适用于 x64 计算机的 WSL2 Linux 内核更新包</a></li><li>运行上一步中下载的更新包。 （双击以运行 - 系统将提示你提供提升的权限，选择“是”以批准此安装。）</li><li>安装完成后，请继续执行下一步 - 在安装新的 Linux 分发时，将 WSL 2 设置为默认版本。</li></ol><h3>三、 <strong>将 WSL 2 设置为默认版本</strong></h3><p>打开 PowerShell，将 WSL 2 设置为默认版本：</p><pre class="language-powershell"><code class="language-powershell">wsl <span class="token operator">--</span><span class="token function">set-default</span><span class="token operator">-</span>version 2</code></pre><h3>四、安装 Linux 分发</h3><p>打开  <a href="https://aka.ms/wslstore">Microsoft Store</a>，并选择你偏好的 Linux 分发版。</p><h3>五、安装 Windows 终端</h3><p>使用 Windows 终端可以打开多个选项卡或窗口窗格，以显示多个 Linux 发行版或其他命令行（PowerShell、命令提示符、Azure CLI 等）并在它们之间快速切换。 可使用独特的配色方案、字体样式、大小、背景图像和自定义键盘快捷键来完全自定义终端。 <a href="https://docs.microsoft.com/en-us/windows/terminal">了解详细信息。</a></p><p><a href="https://docs.microsoft.com/zh-cn/windows/terminal/install">安装 Windows 终端</a>。</p><h2>其他问题</h2><p>如果你的<strong>安装步骤是先安装 Linux 发行版，再更新 WSL2</strong>，则需要手动将 linux 发行版指定到 wsl 2 下运行。请使用管理员权限打开 PowerShell 执行以下命令：</p><ol><li><p>打开获取 WSL 版本和 Linux 发行版名称信息 (check the WSL version)</p><pre class="language-powershell"><code class="language-powershell">wsl <span class="token operator">--</span>list <span class="token operator">--</span>verbose</code></pre><p><img src="https://i.imgur.com/kL5H2oM.png" alt=""></p><p><strong>NAME</strong> 为 Linux 发行版的名称，<strong>VERSION</strong> 为 WSL 的版本</p></li><li><p>更改指定分发的版本 （To set a distribution to be backed by either version of WSL please run）</p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># wsl --set-version &lt;distribution name> &lt;wslversionNumber></span><br>wsl <span class="token operator">--</span><span class="token function">set-version</span> Ubuntu 2</code></pre><p>该命令的 <code>&lt;distribution name&gt;</code> 和 <code>&lt;wslversionNumber&gt;</code> 参数必须是通过第一步获取的 <strong>NAME 和 VERSION</strong> 值。</p></li></ol><h2>参考</h2><ul><li><a href="https://docs.microsoft.com/en-us/windows/wsl/install-manual">https://docs.microsoft.com/en-us/windows/wsl/install-manual</a></li><li><a href="https://docs.microsoft.com/en-us/windows/wsl/install">https://docs.microsoft.com/en-us/windows/wsl/install</a></li><li><strong><a href="https://docs.microsoft.com/en-us/windows/wsl/troubleshooting#error-0x80370102-the-virtual-machine-could-not-be-started-because-a-required-feature-is-not-installed">Troubleshooting Windows Subsystem for Linux</a></strong></li><li><strong><a href="https://docs.microsoft.com/zh-cn/virtualization/hyper-v-on-windows/">Windows 10 上的 Hyper-V</a></strong></li><li><strong><a href="https://www.tenforums.com/tutorials/164318-how-set-linux-distribution-version-wsl-1-wsl-2-windows-10-a.html#:~:text=1%20Open%20an%20PowerShell.%202%20Copy%20and%20paste,You%20can%20now%20close%20PowerShell%20if%20you%20like.">How to Set Linux Distribution version to WSL 1 or WSL 2 in Windows 10</a></strong></li><li><a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-manual">旧版 WSL 的手动安装步骤</a></li><li><a href="https://zinglix.xyz/2020/04/18/wsl2-proxy">WSL2 中访问宿主机 Windows 的代理</a></li></ul></article><footer class="mb-2"><p>byodian's blog</p></footer></div><script src="/index.js"></script><script src="https://kit.fontawesome.com/d101a7035d.js" crossorigin="anonymous"></script></body></html>