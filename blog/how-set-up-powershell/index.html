<!doctype html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="@byodian"><meta name="description" content="PowerShell终端配置"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@byodian"><meta name="twitter:creator" content="@byodian"><meta property="og:title" content="Powershell 终端配置"><meta property="og:type" content="website"><meta property="og:url" content=""><meta property="og:description" content="PowerShell终端配置"><meta property="og:image" content="https://byodiandev.com/static/img/avatar-3x.png"><link rel="icon" type="image/icon" href="/static/img/favicon.ico"><link rel="stylesheet" href="/index.css"><style></style><title>Powershell 终端配置</title></head><body><div id="root" class="container max-w-4xl mx-auto px-6 pt-4"><header class="mt-16 mb-8"><p><a class="font-bold" href="/">byodian's blog</a></p></header><div class="pb-5 mb-5 border-b border-gray-100"><h1 class="text-5xl">Powershell 终端配置</h1><p class="text-gray-400"><time datetime="2022年10月5日">发布于2022年10月5日</time> · <time datetime="2023年3月14日">更新于2023年3月14日</time></p></div><article class="prose lg:prose-lg"><p>请使用 Windwos 操作系统测试本文涉及的命令。</p><h2>探索 Powershell</h2><ul><li><code>Get-Verb</code> Returns a list of verbs that most commands adhere to.</li><li><code>Get-command</code> retrieves a list of all commands installed on your machine.</li><li><code>Get-Member</code> operates on object based output and is able to discover what object, properties and methods are available for a command.</li><li><code>Get-Help</code> displays a help page describing various parts of a command.</li><li><code>Get-ChildItem</code> Gets the items and child items in one or more specified locations. (like <code>ls</code> for Unix)</li><li><code>$Env:&lt;variable-name&gt;</code> display and change the values of environment variables, for example <code>$Env:APPDATA</code>, `$Env:FOO = 'bar'</li><li><code>setx</code> Creates or modifies environment variables in the user or system environment</li></ul><h2>常用命令</h2><ol><li><p><code>Install-Module posh-git -Scope CurrentUser -Force</code> - Install a module by name</p></li><li><p><code>Uninstall-Module -Name oh-my-posh</code> - Uninstall a module by name</p></li><li><p><code>Get-InstalledModule -Name oh-my-posh | Uninstall-Module</code> - Use the pipeline to uninstall a module</p></li><li><p>display all environment variable</p><ol><li><code>Get-ChildItem -Path Env:</code></li><li><code>d﻿ir Env:</code></li><li><code>l﻿s Env:</code></li></ol></li><li><p><code>setx Path &quot;$Env:Path;C:\Program Files\nodejs\node.exe&quot;</code> permanently add node to the environment variable of the Path</p></li><li><p><code>[guid]::NewGuid()</code> generate a Universally Unique Identifier</p></li></ol><h2>配置 <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/tutorials/01-discover-powershell?view=powershell-7.2">PowerShell</a></h2><p>配置过程分两部分，基础配置和自定义配置两部分。在基础配置中我们会创建一些必要的 PowerShell 配置文件，包括 PowerShell 当前用户配置和自定义配置两个文件，而在自定义配置阶段，我们将会安装一些必要的插件以及编写 PowerShell 自定义配置文件。</p><p><strong>注意</strong>：PowerShell 版本必须在 7.2 及以上</p><h3>基础配置</h3><ol><li><p>安装 <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-windows?view=powershell-7.2">PowerShell</a>，<a href="https://apps.microsoft.com/store/detail/powershell/9MZ1SNWT0N5D?hl=zh-cn&amp;gl=cn">微软商店入口</a></p></li><li><p>安装 <a href="https://docs.microsoft.com/en-us/windows/terminal/">Windows terminal</a></p></li><li><p>安装 <a href="https://scoop.sh/">scoop</a> - A command-line installer for Windows</p><p>打开一个 PowerShell，运行命令</p><pre class="language-powershell"><code class="language-powershell"><span class="token function">Set-ExecutionPolicy</span> RemoteSigned <span class="token operator">-</span>Scope CurrentUser <span class="token comment"># Optional: Needed to run a remote script the first time</span><br><span class="token function">irm</span> get<span class="token punctuation">.</span>scoop<span class="token punctuation">.</span>sh <span class="token punctuation">|</span> <span class="token function">iex</span></code></pre></li><li><p>安装 <a href="https://docs.microsoft.com/en-us/windows/package-manager/winget/">Winget</a> - Install and manage applications</p></li><li><p>安装 <a href="https://gitforwindows.org/">git for windows</a> - Offer a lightweight, native set of tools</p><pre class="language-powershell"><code class="language-powershell">winget install <span class="token operator">-</span>e <span class="token operator">--</span>id Git<span class="token punctuation">.</span>Git</code></pre></li><li><p>安装 <code>gcc</code> 、 <code>neovim</code></p><pre class="language-powershell"><code class="language-powershell">scoop install gcc neovim</code></pre></li><li><p>创建 PowerShell 配置文件</p><p>创建 <code>$PROFILE.CurrentUserCurrentHost</code> 文件，生成的文件路径为<code>$Home\Documents\PowerShell\Microsoft.PowerShell_profile.ps1</code></p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># Create a profile</span><br><span class="token function">New-Item</span> <span class="token operator">-</span>Path <span class="token variable">$PROFILE</span><span class="token punctuation">.</span>CurrentUserCurrentHost <span class="token operator">-</span>ItemType <span class="token string">"file"</span> <span class="token operator">-</span>Force<br><br><span class="token comment"># or use notepad commond</span><br>notepad <span class="token variable">$PROFILE</span></code></pre><p>创建 PowerSehll 自定义配置文件 <code>user_profile.ps1</code></p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># $Home\Documents\PowerShell 获取文件的上级路径 </span><br><span class="token function">Split-Path</span> <span class="token variable">$PROFILE</span><span class="token punctuation">.</span>CurrentUserCurrentHOST<br><br>mkdir <span class="token variable">$Home</span>\<span class="token punctuation">.</span>config\powershell<br><span class="token function">New-Item</span> <span class="token variable">$Home</span>\<span class="token punctuation">.</span>config\powershell\user_profile<span class="token punctuation">.</span>ps1</code></pre><p>要使自定义配置文件生效需要在 <code>$PROFILE.CurrentUserCurrentHost</code> 文件中添加以下内容，并重新启动终端。</p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># $Home\Documents\PowerShell\Microsoft.PowerShell_profile.ps1</span><br><span class="token punctuation">.</span> <span class="token variable">$env</span>:USEPROFILE\<span class="token punctuation">.</span>config\powershell\user_profile<span class="token punctuation">.</span>ps1</code></pre><p><strong>The <code>$PROFILE</code> variable</strong> 👉 <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_profiles?view=powershell-7.2">about_profiles</a></p><p>This variable stores the path to the &quot;<strong>Current User, Current Host</strong>&quot; profile. The other profiles are saved in note properties of the <code>$PROFILE</code> variable. For example:</p><table><thead><tr><th>host-specific profiles</th><th>variable</th><th></th></tr></thead><tbody><tr><td>Current User, Current Host</td><td><code>$PROFILE</code></td><td></td></tr><tr><td>Current User, Current Host</td><td><code>$PROFILE.CurrentUserCurrentHost</code></td><td></td></tr><tr><td>Current User, All Hosts</td><td><code>$PROFILE.CurrentUserAllHosts</code></td><td>``</td></tr><tr><td>All Users, Current Host</td><td><code>$PROFILE.AllUsersCurrentHost</code></td><td></td></tr><tr><td>All Users, All Hosts</td><td><code>$PROFILE.AllUsersAllHosts</code></td><td></td></tr></tbody></table><p>以上所有的操作成功后，表示基础的配置准备已经完成，接下来进入安装插件阶段。</p></li></ol><h3>自定义配置（安装插件）</h3><ol><li><p>配置 prompt，下载 <a href="https://ohmyposh.dev/">oh-my-posh</a> (A prompt theme engine for any shell)，安装步骤可以参考 <a href="https://ohmyposh.dev/docs/installation/windows">oh-my-posh 官网安装教程</a></p><ul><li>Prompt for Git repositories</li></ul><p>打开 PowerShell 终端，输入命令</p><pre class="language-powershell"><code class="language-powershell">winget install JanDeDobbeleer<span class="token punctuation">.</span>OhMyPosh <span class="token operator">-</span>s winget<br><span class="token comment"># or</span><br>scoop install https:<span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com/JanDeDobbeleer/oh-my-posh/releases/latest/download/oh-my-posh<span class="token punctuation">.</span>json</code></pre><p>安装完成后，重启你的 PowerShell 终端，开始配置 prompt 主题。编辑之前创建的自定义配置文件，终端输入下面命令可打开此文件</p><pre class="language-powershell"><code class="language-powershell">notepad <span class="token variable">$Home</span>\<span class="token punctuation">.</span>config\powershell\user_profile<span class="token punctuation">.</span>ps1</code></pre><p>然后在配置文件中键入以下内容，开启主题的使用。Oh My Posh 内建了许多开箱即用的<a href="https://ohmyposh.dev/docs/themes">主题</a>，这里我选择 robbyrussel 主题。</p><pre class="language-powershell"><code class="language-powershell">oh-my-posh init pwsh <span class="token operator">--</span>config <span class="token string">"<span class="token variable">$env</span>:POSH_THEMES_PATH\robbyrussel.omp.json"</span> <span class="token punctuation">|</span> <span class="token function">Invoke-Expression</span></code></pre><p>重启 PowerShell 终端，查看 robbyrussel 主题是否生效。</p><p>你也可以自定义主题样式，详细步骤请参考<a href="https://ohmyposh.dev/docs/configuration/overview">Customize</a></p></li><li><p>安装 <a href="https://github.com/dahlbyk/posh-git">posh-git</a></p><p>posh-git 是一个 PowerShell 模块，整合 git 和 PowerShell，提供 git 状态信息，此状态信息可以展示在终端 prompt 中，也提供 tab 键自动补全 git 命令、分支名称和路径等支持。安装步骤参考<a href="https://github.com/dahlbyk/posh-git#installation">posh-git installation</a>，简单步骤如下：</p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># Installing posh-git via PowerShellGet</span><br>PowerShellGet\<span class="token function">Install-Module</span> posh-git <span class="token operator">-</span>Scope CurrentUser <span class="token operator">-</span>Force<br><br><span class="token comment"># or Installing posh-git via Chocolatey</span><br>choco install poshgit<br><br><span class="token comment"># or Installing posh-git via Scoop</span><br>scoop bucket add extras<br>scoop install posh-git</code></pre><p>在自定义配置文件中添加一行，重启终端即可生效。</p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># user_profile.ps1</span><br><span class="token function">Import-Module</span> posh-git</code></pre></li><li><p>安装 <a href="https://github.com/devblackops/Terminal-Icons">terminal icons</a></p><p>一个展示文件和文件夹的图标的 PowerShell 模块。</p><p>此模块必须依赖 <a href="https://github.com/ryanoasis/nerd-fonts">Nerd Fonts</a> 字体，在 <a href="https://www.nerdfonts.com/font-downloads">download</a> 页面选择一款字体，下载并安装字体。</p><p>在终端管理员模式下输入命令安装 Terminal-Icons 模块</p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># Install-Module</span><br><span class="token function">Install-Module</span> <span class="token operator">-</span>Name Terminal-Icons <span class="token operator">-</span>Repository PSGallery <span class="token operator">-</span>Force<br><br><span class="token comment"># or use scoop</span><br>scoop bucket add extras<br>scoop install terminal-icons</code></pre><p>添加下面的内容到自定义配置文件</p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># user_profile.ps1</span><br><span class="token function">Import-Module</span> Terminal-Icons</code></pre></li><li><p>安装 z</p><p>基于你的 cd 命令历史，z 让你在 PowerShell 中快速导航文件系统。在终端管理员模式下输入命令安装 z 模块</p><pre class="language-powershell"><code class="language-powershell"><span class="token function">Install-Module</span> <span class="token operator">-</span>Name z <span class="token operator">-</span>Force <span class="token operator">-</span>AllowClobber </code></pre><p>配置自定义文件，重启终端</p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># user_profile.ps1</span><br><span class="token function">Import-Module</span> z</code></pre></li><li><p>安装 <a href="https://github.com/PowerShell/PSReadLine">PSReadLine</a> - autocompletion</p><p><a href="https://docs.microsoft.com/en-us/powershell/module/psreadline/?view=powershell-7.2">How to use PSReadLine</a></p><pre class="language-powershell"><code class="language-powershell"><span class="token function">Install-Module</span> <span class="token operator">-</span>Name PowerShellGet <span class="token operator">-</span>Force<br><span class="token function">Install-Module</span> <span class="token operator">-</span>Name PSReadLine <span class="token operator">-</span>Force <span class="token operator">-</span>SkipPublisherCheck</code></pre><p>To start using, just import the module:</p><p><code>Import-Module PSReadLine</code></p><p>To view the current key bindings:</p><p><code>Get-PSReadLineKeyHandler</code></p><p>To use Emacs key bindings, you can use:</p><p><code>Set-PSReadLineOption -EditMode Emacs</code></p><p>Specifies the source for PSReadLine to get predictive suggestions.</p><p><code>Set-PSReadLineOption -PredictionSource History</code></p><p>Sets the style for the display of the predictive text. The default is <strong>ListView</strong>.</p><p><code>Set-PSReadLineOption -PredictionViewStyle</code><strong>InlineView</strong></p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># user_profile.ps1</span><br><span class="token function">Import-Module</span> PSReadLine<br><span class="token function">Set-PSReadLineOption</span> <span class="token operator">-</span>EditMode Emacs<br><span class="token function">Set-PSReadLineOption</span> <span class="token operator">-</span>PredictionSource HisoryAndPlugin<br><span class="token function">Set-PSReadLineOption</span> <span class="token operator">-</span>PredictionViewStyle ListView</code></pre></li><li><p>安装 <code>fzf</code> <a href="https://github.com/kelleyma49/PSFzf">PSFzf</a></p><p>PSFzf is a PowerShell module that wraps fzf, a fuzzy file finder for the command line. <a href="https://github.com/kelleyma49/PSFzf/issues/190">Failed to import module</a></p><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># 安装 fzf</span><br>scoop install fzf<br><span class="token comment"># 安装 PSFzf</span><br><span class="token function">Install-Module</span> <span class="token operator">-</span>Name PSFzf <span class="token operator">-</span>RequiredVersion 2<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0 <span class="token operator">-</span>Scope CurrentUser <span class="token operator">-</span>Force</code></pre><p>自定义文件添加下面的内容</p><pre class="language-powershell"><code class="language-powershell"><span class="token function">Import-Module</span> PSFzf<br><span class="token function">Set-PsFzfOption</span> <span class="token operator">-</span>PSReadLineChordProvider <span class="token string">'Ctrl+f'</span> <span class="token operator">-</span>PSReadLineChordReverseHistory <span class="token string">'Ctrl+r'</span></code></pre></li><li><p>重启配置文件</p></li></ol><pre class="language-powershell"><code class="language-powershell"><span class="token punctuation">.</span> <span class="token variable">$PROFILE</span></code></pre><h2>user_profile.ps1 自定义配置文件</h2><pre class="language-powershell"><code class="language-powershell"><span class="token function">Import-Module</span> posh-git<br><span class="token function">Import-Module</span> Terminal-Icons<br><span class="token function">Import-Module</span> z<br>oh-my-posh init pwsh <span class="token operator">--</span>config <span class="token string">"<span class="token variable">$env</span>:POSH_THEMES_PATH\robbyrussel.omp.json"</span> <span class="token punctuation">|</span> <span class="token function">Invoke-Expression</span><br><br><span class="token comment"># PSReadLine</span><br><span class="token function">Import-Module</span> PSReadLine<br><span class="token function">Set-PSReadLineOption</span> <span class="token operator">-</span>EditMode Emacs<br><span class="token function">Set-PSReadLineOption</span> <span class="token operator">-</span>PredictionSource History<br><span class="token function">Set-PSReadLineOption</span> <span class="token operator">-</span>PredictionViewStyle InlineView<br><br><span class="token comment"># fzf</span><br><span class="token function">Import-Module</span> PSFzf<br><span class="token function">Set-PsFzfOption</span> <span class="token operator">-</span>PSReadLineChordProvider <span class="token string">'Ctrl+f'</span> <span class="token operator">-</span>PSReadLineChordReverseHistory <span class="token string">'Ctrl+r'</span><br><br><span class="token comment"># Alias</span><br><span class="token function">Set-Alias</span> ll <span class="token function">ls</span><br><span class="token function">Set-Alias</span> c clear<br><span class="token function">Set-Alias</span> less <span class="token string">'C:\Program Files\Git\usr\bin\less.exe'</span><br><span class="token function">Set-Alias</span> tig <span class="token string">'C:\Program Files\Git\usr\bin\tig.exe'</span><br><br><span class="token keyword">function</span> which<span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token function">Get-command</span> <span class="token operator">-</span>Name <span class="token variable">$command</span> <span class="token operator">-</span>ErrorAction SilentlyContinue <span class="token punctuation">|</span> <br>    <span class="token function">Select-Object</span> <span class="token operator">-</span>ExpandProperty Path <span class="token operator">-</span>ErrorAction SilentlyContinue<br><span class="token punctuation">}</span></code></pre><h2>资源</h2><ul><li><p><a href="https://www.powershellgallery.com/packages/PSFzf/2.0.0">https://www.powershellgallery.com/packages/PSFzf/2.0.0</a></p></li><li><p><a href="https://www.powershellgallery.com/">https://www.powershellgallery.com/</a></p></li><li><p><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_environment_provider?view=powershell-7.2">about_Environment_Provider</a> The environment Environment provider lets you get, add, change, clear, delete environment variables and values in Powershell.</p><p>Windows and Powershell use Environment variables to store persistent information that affect system and process execution.</p><p>Unlike PowerShell variables, environment variables are not subject to scope constraints.</p><p>The Environment provider supports the following cmdlets.</p><ul><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-location?view=powershell-7.2">Get-Location</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/set-location?view=powershell-7.2">Set-Location</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-item?view=powershell-7.2">Get-Item</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-item?view=powershell-7.2">New-Item</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/remove-item?view=powershell-7.2">Remove-Item</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/clear-item?view=powershell-7.2">Clear-Item</a></li><li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_modules?view=powershell-7.3">aA﻿bout Modules</a></li><li><a href="https://learn.microsoft.com/en-us/powershell/module/psreadline/about/about_psreadline?view=powershell-7.3">about_PSReadLine</a></li></ul></li><li><p><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_environment_variables?view=powershell-7.2">about_Environment_Variables</a> Environment variables store information about the operating system environment.</p><p>The environment variables store data that is used by the operating system and other programs.</p></li><li><p><a href="https://docs.microsoft.com/zh-cn/powershell/module/microsoft.powershell.core/about/about_commonparameters?view=powershell-7.2">about_CommonParameters</a> 描述可与任何 cmdlet 一起使用的参数。</p></li></ul><h2>参考</h2><ul><li><a href="https://ohmyposh.dev/docs/migrating">PowerShell module</a></li></ul></article><footer class="mb-2"><p>byodian's blog</p></footer></div><script src="/index.js"></script><script src="https://kit.fontawesome.com/d101a7035d.js" crossorigin="anonymous"></script></body></html>